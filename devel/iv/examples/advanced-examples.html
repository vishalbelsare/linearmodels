

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>Further Examples &#8212; linearmodels 3.5+14.gf04346f documentation</title>
    <link rel="stylesheet" href="../../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.5+14.gf04346f',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Using formulas to specify models" href="using-formulas.html" />
    <link rel="prev" title="Basic Examples" href="basic-examples.html" />
  
  
   

  <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />

  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="using-formulas.html" title="Using formulas to specify models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="basic-examples.html" title="Basic Examples"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">linearmodels 3.5+14.gf04346f documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Instrumental Variable Estimation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
        <a href="
    ../../index.html" class="text-logo">linearmodels 3.5 (+14, gf04346f)</a>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Instrumental Variable Estimation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic-examples.html">Basic Examples</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Further Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-formulas.html">Using formulas to specify models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference.html">Module Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mathematical-formula.html">Formulas and Mathematical Detail</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../panel/index.html">Panel Data Model Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../asset-pricing/index.html">Linear Factor Models for Asset Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../system/index.html">System Regression Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utility.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plan.html">Module Plans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../references.html">References</a></li>
</ul>

    
  </div>
</div>
        
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../../index.html">Docs</a></li>
              
                <li><a href="../index.html">Instrumental Variable Estimation</a></li>
              
              <li>Further Examples</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="Further-Examples">
<h1>Further Examples<a class="headerlink" href="#Further-Examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Linear-Instrumental-Variables-Regression">
<h2>Linear Instrumental-Variables Regression<a class="headerlink" href="#Linear-Instrumental-Variables-Regression" title="Permalink to this headline">¶</a></h2>
<p>These examples follow those in <strong>Chapter 6</strong> of <em>Microeconometrics Using
Stata</em> by Cameron &amp; Trivedi.</p>
<p>The first step is to import the main estimator for linear IV models:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IV2SLS</span></code> - standard two-stage least squares</li>
<li><code class="docutils literal"><span class="pre">IVLIML</span></code> - Limited information maximum likelihood and k-class
estimators</li>
<li><code class="docutils literal"><span class="pre">IVGMM</span></code> - Generalized method of moment estimation</li>
<li><code class="docutils literal"><span class="pre">IVGMMCUE</span></code> - Generalized method of moment estimation using
continuously updating</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">linearmodels</span> <span class="kn">import</span> <span class="n">IV2SLS</span><span class="p">,</span> <span class="n">IVLIML</span><span class="p">,</span> <span class="n">IVGMM</span><span class="p">,</span> <span class="n">IVGMMCUE</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Importing-data">
<h2>Importing data<a class="headerlink" href="#Importing-data" title="Permalink to this headline">¶</a></h2>
<p>The data uses comes from the Medical Expenditure Panel Survey (MEPS) and
includes data on out-of-pocket drug expenditure (in logs), individual
characteristics, whether an individual was insured through an employer
or union (a likely endogenous variable), and some candidate instruments
including the percentage of income from Social Security Income, the size
of the individual’s firm and whether the firm has multiple locations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">linearmodels.datasets</span> <span class="kn">import</span> <span class="n">meps</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">meps</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">meps</span><span class="o">.</span><span class="n">DESCR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

age               Age
age2              Age-squared
black             Black
blhisp            Black or Hispanic
drugexp           Presc-drugs expense
educyr            Years of education
fair              Fair health
female            Female
firmsz            Firm size
fph               fair or poor health
good              Good health
hi_empunion       Insured thro emp/union
hisp              Hiapanic
income            Income
ldrugexp          log(drugexp)
linc              log(income)
lowincome         Low income
marry             Married
midincome         Middle income
msa               Metropolitan stat area
multlc            Multiple locations
poor              Poor health
poverty           Poor
priolist          Priority list cond
private           Private insurance
ssiratio          SSI/Income ratio
totchr            Total chronic cond
vegood            V-good health
vgh               vg or good health

</pre></div></div>
</div>
<p>Next the data – dependent, endogenous and controls – are summarized.
The controls are grouped into a list to simplify model building.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">controls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;totchr&#39;</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;linc&#39;</span><span class="p">,</span><span class="s1">&#39;blhisp&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ldrugexp&#39;</span><span class="p">,</span><span class="s1">&#39;hi_empunion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
           ldrugexp   hi_empunion        totchr        female           age  \
count  10089.000000  10089.000000  10089.000000  10089.000000  10089.000000
mean       6.481361      0.382198      1.860938      0.577064     75.051740
std        1.362052      0.485949      1.292858      0.494050      6.682109
min        0.000000      0.000000      0.000000      0.000000     65.000000
50%        6.678342      0.000000      2.000000      1.000000     74.000000
max       10.180172      1.000000      9.000000      1.000000     91.000000

               linc        blhisp
count  10089.000000  10089.000000
mean       2.743275      0.163544
std        0.913143      0.369880
min       -6.907755      0.000000
50%        2.743160      0.000000
max        5.744476      1.000000
</pre></div></div>
</div>
<p>It is also worth examining the instruments.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">instruments</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span> <span class="s1">&#39;lowincome&#39;</span><span class="p">,</span> <span class="s1">&#39;multlc&#39;</span><span class="p">,</span> <span class="s1">&#39;firmsz&#39;</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">instruments</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">percentiles</span><span class="o">=</span><span class="p">[]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
           ssiratio     lowincome        multlc        firmsz
count  10089.000000  10089.000000  10089.000000  10089.000000
mean       0.536544      0.187432      0.062048      0.140529
std        0.367818      0.390277      0.241254      2.170389
min        0.000000      0.000000      0.000000      0.000000
50%        0.504522      0.000000      0.000000      0.000000
max        9.250620      1.000000      1.000000     50.000000
</pre></div></div>
</div>
<p>And finally the simple correlation between the endogenous variable and
the instruments. Instruments must be correlated to be relevant (but also
must be exogenous, which can’t be examined using simple correlation).
THe correlation of <code class="docutils literal"><span class="pre">firmsz</span></code> is especially low, which might lead to the
weak instruments problem if used exclusively.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;hi_empunion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">instruments</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hi_empunion</th>
      <th>ssiratio</th>
      <th>lowincome</th>
      <th>multlc</th>
      <th>firmsz</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>hi_empunion</th>
      <td>1.000000</td>
      <td>-0.212431</td>
      <td>-0.116419</td>
      <td>0.119849</td>
      <td>0.037352</td>
    </tr>
    <tr>
      <th>ssiratio</th>
      <td>-0.212431</td>
      <td>1.000000</td>
      <td>0.253946</td>
      <td>-0.190433</td>
      <td>-0.044578</td>
    </tr>
    <tr>
      <th>lowincome</th>
      <td>-0.116419</td>
      <td>0.253946</td>
      <td>1.000000</td>
      <td>-0.062465</td>
      <td>-0.008232</td>
    </tr>
    <tr>
      <th>multlc</th>
      <td>0.119849</td>
      <td>-0.190433</td>
      <td>-0.062465</td>
      <td>1.000000</td>
      <td>0.187275</td>
    </tr>
    <tr>
      <th>firmsz</th>
      <td>0.037352</td>
      <td>-0.044578</td>
      <td>-0.008232</td>
      <td>0.187275</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal"><span class="pre">add_constant</span></code> from <code class="docutils literal"><span class="pre">statsmodels</span></code> is used to simplify the process of
adding a constant column to the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">statsmodels.api</span> <span class="kn">import</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">add_constant</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">controls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/travis/miniconda3/envs/linearmodels-test/lib/python3.5/site-packages/statsmodels/compat/pandas.py:56: FutureWarning: The pandas.core.datetools module is deprecated and will be removed in a future version. Please use the pandas.tseries module instead.
  from pandas.core import datetools
</pre></div></div>
</div>
</div>
<div class="section" id="2SLS-as-OLS">
<h2>2SLS as OLS<a class="headerlink" href="#2SLS-as-OLS" title="Permalink to this headline">¶</a></h2>
<p>Before examining the IV estimators, it is worth noting that 2SLS nests
the OLS estimator, so that a call to <code class="docutils literal"><span class="pre">IV2SLS</span></code> using <code class="docutils literal"><span class="pre">None</span></code> for the
endogenous and instruments will produce OLS estimates of parameters.</p>
<p>The OLS estimates indicate that insurance through an employer or union
leads to an <strong>increase</strong> in out-of-pocket drug expenditure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivolsmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;hi_empunion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">res_ols</span> <span class="o">=</span> <span class="n">ivolsmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">res_ols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                            OLS Estimation Summary
==============================================================================
Dep. Variable:               ldrugexp   R-squared:                      0.1770
Estimator:                        OLS   Adj. R-squared:                 0.1765
No. Observations:               10089   F-statistic:                    2262.6
Date:                Fri, Aug 18 2017   P-value (F-stat)                0.0000
Time:                        22:55:34   Distribution:                  chi2(6)
Cov. Estimator:                robust

                              Parameter Estimates
===============================================================================
             Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
-------------------------------------------------------------------------------
hi_empunion     0.0739     0.0260     2.8441     0.0045      0.0230      0.1248
const           5.8611     0.1570     37.320     0.0000      5.5533      6.1689
totchr          0.4404     0.0094     47.049     0.0000      0.4220      0.4587
female          0.0578     0.0254     2.2797     0.0226      0.0081      0.1075
age            -0.0035     0.0019    -1.8228     0.0683     -0.0073      0.0003
linc            0.0105     0.0137     0.7646     0.4445     -0.0164      0.0373
blhisp         -0.1513     0.0341    -4.4353     0.0000     -0.2182     -0.0844
===============================================================================
</pre></div></div>
</div>
</div>
<div class="section" id="Just-identified-2SLS">
<h2>Just identified 2SLS<a class="headerlink" href="#Just-identified-2SLS" title="Permalink to this headline">¶</a></h2>
<p>The just identified two-stage LS estimator uses as many instruments as
endogenous variables. In this example there is one of each, using the
SSI ratio as the instrument. The with the instrument, the effect of
insurance through employer or union has a strong negative effect on drug
expenditure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">ssiratio</span><span class="p">)</span>
<span class="n">res_2sls</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">res_2sls</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                          IV-2SLS Estimation Summary
==============================================================================
Dep. Variable:               ldrugexp   R-squared:                      0.0640
Estimator:                    IV-2SLS   Adj. R-squared:                 0.0634
No. Observations:               10089   F-statistic:                    2000.9
Date:                Fri, Aug 18 2017   P-value (F-stat)                0.0000
Time:                        22:55:34   Distribution:                  chi2(6)
Cov. Estimator:                robust

                              Parameter Estimates
===============================================================================
             Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
-------------------------------------------------------------------------------
const           6.7872     0.2688     25.246     0.0000      6.2602      7.3141
totchr          0.4503     0.0102     44.157     0.0000      0.4303      0.4703
female         -0.0204     0.0326    -0.6257     0.5315     -0.0843      0.0435
age            -0.0132     0.0030    -4.4092     0.0000     -0.0191     -0.0073
linc            0.0870     0.0226     3.8436     0.0001      0.0426      0.1314
blhisp         -0.2174     0.0395    -5.5052     0.0000     -0.2948     -0.1400
hi_empunion    -0.8976     0.2211    -4.0592     0.0000     -1.3310     -0.4642
===============================================================================

Endogenous: hi_empunion
Instruments: ssiratio
Robust Covariance (Heteroskedastic)
Debiased: False
</pre></div></div>
</div>
</div>
<div class="section" id="Multiple-Instruments">
<h2>Multiple Instruments<a class="headerlink" href="#Multiple-Instruments" title="Permalink to this headline">¶</a></h2>
<p>Using multiple instruments only requires expanding the data array in the
instruments input.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]])</span>
<span class="n">res_2sls_robust</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Alternative-covariance-estimators">
<h2>Alternative covariance estimators<a class="headerlink" href="#Alternative-covariance-estimators" title="Permalink to this headline">¶</a></h2>
<p>All estimator allow for three types of parameter covariance estimator:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'unadjusted'</span></code> is the classic homoskedastic estimator</li>
<li><code class="docutils literal"><span class="pre">'robust'</span></code> is robust to heteroskedasticity</li>
<li><code class="docutils literal"><span class="pre">'clustered'</span></code> allows one- or two-way clustering to account for
additional sources of dependence between the model scores</li>
<li><code class="docutils literal"><span class="pre">'kernel'</span></code> produces a heteroskedasticity-autocorrelation robust
covariance estimator</li>
</ul>
<p>The default is <code class="docutils literal"><span class="pre">'robust'</span></code>.</p>
<p>These are all passed using the keyword input <code class="docutils literal"><span class="pre">cov_type</span></code>. Using
clustered requires also passing the clustering variable(s).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]])</span>
<span class="n">res_2sls_std</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;unadjusted&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="GMM-Estimation">
<h2>GMM Estimation<a class="headerlink" href="#GMM-Estimation" title="Permalink to this headline">¶</a></h2>
<p>GMM estimation can be more efficient than 2SLS when there are more than
one instrument. By default, 2-step efficient GMM is used (assuming the
weighting matrix is correctly specified). It is possible to iterate
until convergence using the optional keyword input <code class="docutils literal"><span class="pre">iter_limit</span></code>, which
is naturally 2 by default. Generally, GMM-CUE would be preferred to
using multiple iterations of standard GMM.</p>
<p>The default weighting matrix is robust to heteroskecasticity (but not
clustering).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span><span class="n">IVGMM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]])</span>
<span class="n">res_gmm</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Changing-the-weighting-matrix-structure-in-GMM-estimation">
<h2>Changing the weighting matrix structure in GMM estimation<a class="headerlink" href="#Changing-the-weighting-matrix-structure-in-GMM-estimation" title="Permalink to this headline">¶</a></h2>
<p>The weighting matrix in the GMM objective function can be altered when
creating the model. This example uses clustered weight by age. The
covariance estimator should usually match the weighting matrix, and so
clustering is also used here.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IVGMM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]],</span>
                <span class="n">weight_type</span><span class="o">=</span><span class="s1">&#39;clustered&#39;</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
<span class="n">res_gmm_clustered</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;clustered&#39;</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Continuously-updating-GMM">
<h2>Continuously updating GMM<a class="headerlink" href="#Continuously-updating-GMM" title="Permalink to this headline">¶</a></h2>
<p>The continuously updating GMM estimator simultaneously optimizes the
moment conditions and the weighting matrix. It can be more efficient (in
the second order sense) than standard 2-step GMM, although it can also
be fragile. Here the optional input <code class="docutils literal"><span class="pre">display</span></code> is used to produce the
output of the non-linear optimizer used to estimate the parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IVGMMCUE</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]])</span>
<span class="n">res_gmm_cue</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Warning: Desired error not necessarily achieved due to precision loss.
         Current function value: 1.045365
         Iterations: 10
         Function evaluations: 759
         Gradient evaluations: 83
</pre></div></div>
</div>
</div>
<div class="section" id="Comparing-results">
<h2>Comparing results<a class="headerlink" href="#Comparing-results" title="Permalink to this headline">¶</a></h2>
<p>The function <code class="docutils literal"><span class="pre">compare</span></code> can be used to compare the results of multiple
models, possibly with different variables, estimators and/or
instruments. Usually a dictionary or <code class="docutils literal"><span class="pre">OrderedDict</span></code> is used to hold
results since the keys are used as model names. The advantage of an
<code class="docutils literal"><span class="pre">OrderedDict</span></code> is that it will preserve the order of the models in the
presentation.</p>
<p>With the expectation of the OLS estimate, the parameter estimates are
fairly consistent. Standard errors vary slightly although the
conclusions reached are not sensitive to the choice of covariance
estimator either. T-stats are reported in parentheses.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">linearmodels.iv.results</span> <span class="kn">import</span> <span class="n">compare</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;OLS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ols</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;2SLS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_2sls</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;2SLS-Homo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_2sls_std</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;2SLS-Hetero&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_2sls_robust</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;GMM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gmm</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;GMM Cluster(Age)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gmm_clustered</span>
<span class="n">res</span><span class="p">[</span><span class="s1">&#39;GMM-CUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gmm_cue</span>
<span class="k">print</span><span class="p">(</span><span class="n">compare</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                                     Model Comparison
==========================================================================================================================
                               OLS          2SLS      2SLS-Homo   2SLS-Hetero           GMM GMM Cluster(Age)       GMM-CUE
--------------------------------------------------------------------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp       ldrugexp      ldrugexp      ldrugexp         ldrugexp      ldrugexp
Estimator                      OLS       IV-2SLS        IV-2SLS       IV-2SLS        IV-GMM           IV-GMM        IV-GMM
No. Observations             10089         10089          10089         10089         10089            10089         10089
Cov. Est.                   robust        robust     unadjusted        robust        robust        clustered        robust
R-squared                   0.1770        0.0640         0.0414        0.0414        0.0406           0.0292        0.0388
Adj. R-squared              0.1765        0.0634         0.0409        0.0409        0.0400           0.0286        0.0382
F-statistic                 2262.6        2000.9         1882.3        1955.4        1952.6           1700.8        1949.2
P-value (F-stat)            0.0000        0.0000         0.0000        0.0000        0.0000           0.0000        0.0000
==================     ===========   ===========   ============   ===========   ===========      ===========   ===========
age                        -0.0035       -0.0132        -0.0141       -0.0141       -0.0142          -0.0119       -0.0142
                         (-1.8228)     (-4.4092)      (-5.0834)     (-4.8753)     (-4.8773)        (-1.8928)     (-4.8969)
blhisp                     -0.1513       -0.2174        -0.2237       -0.2237       -0.2231          -0.2091       -0.2236
                         (-4.4353)     (-5.5052)      (-5.7805)     (-5.6514)     (-5.6344)        (-4.1662)     (-5.6421)
const                       5.8611        6.7872         6.8752        6.8752        6.8778           6.7277        6.8847
                          (37.320)      (25.246)       (28.030)      (26.660)      (26.658)         (13.299)      (26.657)
female                      0.0578       -0.0204        -0.0278       -0.0278       -0.0282          -0.0245       -0.0288
                          (2.2797)     (-0.6257)      (-0.8933)     (-0.8653)     (-0.8752)        (-0.8398)     (-0.8928)
hi_empunion                 0.0739       -0.8976        -0.9899       -0.9899       -0.9933          -1.0359       -1.0002
                          (2.8441)     (-4.0592)      (-5.1501)     (-4.8386)     (-4.8530)        (-5.0683)     (-4.8810)
linc                        0.0105        0.0870         0.0943        0.0943        0.0945           0.0957        0.0950
                          (0.7646)      (3.8436)       (4.4400)      (4.3079)      (4.3142)         (6.4934)      (4.3333)
totchr                      0.4404        0.4503         0.4512        0.4512        0.4510           0.4482        0.4510
                          (47.049)      (44.157)       (42.942)      (43.769)      (43.738)         (33.833)      (43.701)
==================== ============= ============= ============== ============= =============    ============= =============
Instruments                             ssiratio       ssiratio      ssiratio      ssiratio         ssiratio      ssiratio
                                                         multlc        multlc        multlc           multlc        multlc
--------------------------------------------------------------------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div>
</div>
</div>
<div class="section" id="Testing-endogeneity">
<h2>Testing endogeneity<a class="headerlink" href="#Testing-endogeneity" title="Permalink to this headline">¶</a></h2>
<p>The Durbin test is a classic of endogeneity which compares OLS estimates
with 2SLS and exploits the fact that OLS estimates will be relatively
efficient. Durbin’s test is not robust to heteroskedasticity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">res_2sls</span><span class="o">.</span><span class="n">durbin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[15]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Durbin test of exogeneity
H0: All endogenous variables are exogenous
Statistic: 25.2819
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x2b0422ae3780
</pre></div>
</div>
</div>
<p>The Wu-Hausman test is a variant of the Durbin test that uses a slightly
different form.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">res_2sls</span><span class="o">.</span><span class="n">wu_hausman</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[16]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Wu-Hausman test of exogeneity
H0: All endogenous variables are exogenous
Statistic: 25.3253
P-value: 0.0000
Distributed: F(1,10081)
WaldTestStatistic, id: 0x2b0422ae37f0
</pre></div>
</div>
</div>
<p>The test statistic can be directly replicated using the squared t-stat
in a 2-stage approach where the first stage regresses the endogenous
variable on the controls and instrument and the second stage regresses
the dependent variable on the controls, the endogenous regressor and the
residuals. If the regresssor was in fact exogenous, the residuals should
not be correlated with the dependent variable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">step1</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">resids</span> <span class="o">=</span> <span class="n">step1</span><span class="o">.</span><span class="n">resids</span>
<span class="n">exog</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;hi_empunion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span><span class="p">],</span> <span class="n">resids</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
<span class="n">step2</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;unadjusted&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">step2</span><span class="o">.</span><span class="n">tstats</span><span class="o">.</span><span class="n">residual</span> <span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
25.3454104997
</pre></div></div>
</div>
<p>Wooldridge’s regression-based test of exogeneity is robust to
heteroskedasticity since it inherits the covariance estimator from the
model. Here there is little difference.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">res_2sls</span><span class="o">.</span><span class="n">wooldridge_regression</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[18]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Wooldridge&#39;s regression test of exogeneity
H0: Endogenous variables are exogenous
Statistic: 26.4542
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x2b04278dd780
</pre></div>
</div>
</div>
<p>Wooldridge’s score test is an alternative to the regression test,
although it usually has slightly less power since it is an LM rather
than a Wald type test.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">res_2sls</span><span class="o">.</span><span class="n">wooldridge_score</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>Wooldridge&#39;s score test of exogeneity
H0: Endogenous variables are exogenous
Statistic: 24.9350
P-value: 0.0000
Distributed: chi2(1)
WaldTestStatistic, id: 0x2b042788ed68
</pre></div>
</div>
</div>
<div class="section" id="Exogeneity-Testing">
<h3>Exogeneity Testing<a class="headerlink" href="#Exogeneity-Testing" title="Permalink to this headline">¶</a></h3>
<p>When there is more than one instrument (the model is overidentified),
the J test can be used in GMM models to test whether the model is
overidentified – in other words, whether the instruments are actually
exogenous (assuming they are relevant). In the case with 2 instruments
there is no evidence that against the null.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">res_gmm</span><span class="o">.</span><span class="n">j_stat</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>H0: Expected moment conditions are equal to 0
Statistic: 1.0475
P-value: 0.3061
Distributed: chi2(1)
WaldTestStatistic, id: 0x2b04274e89e8
</pre></div>
</div>
</div>
<p>When all instruments are included the story changes, and some of the
additional instrument (<code class="docutils literal"><span class="pre">lowincome</span></code> or <code class="docutils literal"><span class="pre">firmsz</span></code>) appear to be
endogenous.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IVGMM</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">instruments</span><span class="p">])</span>
<span class="n">res_gmm_all</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">res_gmm_all</span><span class="o">.</span><span class="n">j_stat</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>H0: Expected moment conditions are equal to 0
Statistic: 11.5903
P-value: 0.0089
Distributed: chi2(3)
WaldTestStatistic, id: 0x2b0427c33d68
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Single-Instrument-Regressions">
<h2>Single Instrument Regressions<a class="headerlink" href="#Single-Instrument-Regressions" title="Permalink to this headline">¶</a></h2>
<p>It can be useful to run the just identified regressions to see how the
IV estimate varies by instrument. The OLS model is included for
comparrison. The coefficient when using <code class="docutils literal"><span class="pre">lowincome</span></code> is very similar to
the OLS as is the <span class="math">\(R^2\)</span> which indicates this variable may be
endogenous. The coefficient using <code class="docutils literal"><span class="pre">firmsz</span></code> is also very different, but
this is probably due to the low correlation between <code class="docutils literal"><span class="pre">firmsz</span></code> and the
endogenous regressor so that this is a weak instrument.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">instruments</span><span class="p">:</span>
    <span class="n">od</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">)</span>
<span class="n">od</span><span class="p">[</span><span class="s1">&#39;OLS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_ols</span>
<span class="k">print</span><span class="p">(</span><span class="n">compare</span><span class="p">(</span><span class="n">od</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                     Model Comparison
==========================================================================================
                          ssiratio     lowincome        multlc        firmsz           OLS
------------------------------------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp      ldrugexp      ldrugexp      ldrugexp
Estimator                  IV-2SLS       IV-2SLS       IV-2SLS       IV-2SLS           OLS
No. Observations             10089         10089         10089         10089         10089
Cov. Est.                   robust        robust        robust        robust        robust
R-squared                   0.0640        0.1768       -0.0644       -0.9053        0.1770
Adj. R-squared              0.0634        0.1763       -0.0651       -0.9064        0.1765
F-statistic                 2000.9        2250.6        1734.1        950.64        2262.6
P-value (F-stat)            0.0000        0.0000        0.0000        0.0000        0.0000
==================     ===========   ===========   ===========   ===========   ===========
age                        -0.0132       -0.0031       -0.0177       -0.0335       -0.0035
                         (-4.4092)     (-0.7521)     (-3.7086)     (-2.3433)     (-1.8228)
blhisp                     -0.2174       -0.1484       -0.2479       -0.3559       -0.1513
                         (-5.5052)     (-3.5639)     (-5.0727)     (-3.2425)     (-4.4353)
const                       6.7872        5.8201        7.2145        8.7267        5.8611
                          (25.246)      (15.267)      (16.326)      (6.4196)      (37.320)
female                     -0.0204        0.0613       -0.0565       -0.1842        0.0578
                         (-0.6257)      (1.6066)     (-1.2596)     (-1.5312)      (2.2797)
hi_empunion                -0.8976        0.1170       -1.3459       -2.9323        0.0739
                         (-4.0592)      (0.3254)     (-3.1760)     (-2.0908)      (2.8441)
linc                        0.0870        0.0071        0.1223        0.2473        0.0105
                          (3.8436)      (0.2280)      (3.2965)      (2.1876)      (0.7646)
totchr                      0.4503        0.4399        0.4548        0.4710        0.4404
                          (44.157)      (43.834)      (39.193)      (23.163)      (47.049)
==================== ============= ============= ============= ============= =============
Instruments               ssiratio     lowincome        multlc        firmsz
------------------------------------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div>
</div>
<div class="section" id="First-Stage-Diagnostics">
<h3>First Stage Diagnostics<a class="headerlink" href="#First-Stage-Diagnostics" title="Permalink to this headline">¶</a></h3>
<p>First stage diagnostics are available to assess whether the instruments
appear to be credible for the endogenous regressor. The Partial
F-statistic is the F-statistic for all instruments once controls have
been partialed out. In the case of a single instrument, it is just the
squared t-stat.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">res_2sls</span><span class="o">.</span><span class="n">first_stage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    First Stage Estimation Results
======================================
                           hi_empunion
--------------------------------------
R-squared                       0.0761
Partial R-squared               0.0179
Shea&#39;s R-squared                0.0179
Partial F-statistic             65.806
P-value (Partial F-stat)     4.441e-16
Partial F-stat Distn           chi2(1)
========================== ===========
const                           1.0290
                              (17.705)
totchr                          0.0128
                              (3.4896)
female                         -0.0734
                             (-7.6226)
age                            -0.0086
                             (-12.184)
linc                            0.0484
                              (7.3266)
blhisp                         -0.0627
                             (-5.1084)
ssiratio                       -0.1916
                             (-8.1121)
--------------------------------------

T-stats reported in parentheses
T-stats use same covariance type as original model
</pre></div></div>
</div>
<p>The F-statistic actually has a <span class="math">\(chi^2\)</span> distribution since it is
just a Wald test that all of the coefficients are 0. This breaks the
“rule-of-thumb” but it can be applied by dividing the F-stat by the
number of instruments.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">instruments</span><span class="p">])</span>
<span class="n">res_2sls_all</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">res_2sls_all</span><span class="o">.</span><span class="n">first_stage</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
    First Stage Estimation Results
======================================
                           hi_empunion
--------------------------------------
R-squared                       0.0821
Partial R-squared               0.0243
Shea&#39;s R-squared                0.0243
Partial F-statistic             179.47
P-value (Partial F-stat)        0.0000
Partial F-stat Distn           chi2(4)
========================== ===========
const                           0.9899
                              (16.959)
totchr                          0.0133
                              (3.6494)
female                         -0.0724
                             (-7.5497)
age                            -0.0080
                             (-11.206)
linc                            0.0410
                              (6.3552)
blhisp                         -0.0676
                             (-5.5369)
ssiratio                       -0.1690
                             (-7.3289)
lowincome                      -0.0637
                             (-5.1947)
multlc                          0.1151
                              (5.4799)
firmsz                          0.0037
                              (1.9286)
--------------------------------------

T-stats reported in parentheses
T-stats use same covariance type as original model
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="LIML">
<h2>LIML<a class="headerlink" href="#LIML" title="Permalink to this headline">¶</a></h2>
<p>The LIML estimator and related k-class estimators can be used through
<code class="docutils literal"><span class="pre">IVLIML</span></code>. LIML can have better finite sample properties if the model
is not strongly identified. By default the <span class="math">\(\kappa\)</span> parameter is
estimated. In this dataset it is very close to 1 and to the results for
LIML are similar to 2SLS (they would be exact if <span class="math">\(\kappa=1\)</span>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="n">ivmod</span> <span class="o">=</span> <span class="n">IVLIML</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">controls</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">hi_empunion</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;ssiratio&#39;</span><span class="p">,</span><span class="s1">&#39;multlc&#39;</span><span class="p">]])</span>
<span class="n">res_liml</span> <span class="o">=</span> <span class="n">ivmod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;robust&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">compare</span><span class="p">({</span><span class="s1">&#39;2SLS&#39;</span><span class="p">:</span><span class="n">res_2sls_robust</span><span class="p">,</span><span class="s1">&#39;LIML&#39;</span><span class="p">:</span> <span class="n">res_liml</span><span class="p">,</span> <span class="s1">&#39;GMM&#39;</span><span class="p">:</span> <span class="n">res_gmm</span><span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                       Model Comparison
==============================================================
                              2SLS           GMM          LIML
--------------------------------------------------------------
Dep. Variable             ldrugexp      ldrugexp      ldrugexp
Estimator                  IV-2SLS        IV-GMM       IV-LIML
No. Observations             10089         10089         10089
Cov. Est.                   robust        robust        robust
R-squared                   0.0414        0.0406        0.0400
Adj. R-squared              0.0409        0.0400        0.0394
F-statistic                 1955.4        1952.6        1952.3
P-value (F-stat)            0.0000        0.0000        0.0000
==================     ===========   ===========   ===========
const                       6.8752        6.8778        6.8807
                          (26.660)      (26.658)      (26.577)
totchr                      0.4512        0.4510        0.4513
                          (43.769)      (43.738)      (43.730)
female                     -0.0278       -0.0282       -0.0283
                         (-0.8653)     (-0.8752)     (-0.8776)
age                        -0.0141       -0.0142       -0.0142
                         (-4.8753)     (-4.8773)     (-4.8781)
linc                        0.0943        0.0945        0.0947
                          (4.3079)      (4.3142)      (4.3114)
blhisp                     -0.2237       -0.2231       -0.2241
                         (-5.6514)     (-5.6344)     (-5.6531)
hi_empunion                -0.9899       -0.9933       -0.9957
                         (-4.8386)     (-4.8530)     (-4.8361)
==================== ============= ============= =============
Instruments               ssiratio      ssiratio      ssiratio
                            multlc        multlc        multlc
--------------------------------------------------------------

T-stats reported in parentheses
</pre></div></div>
</div>
<p>The estimated value of <span class="math">\(\kappa\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">res_liml</span><span class="o">.</span><span class="n">kappa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.00011531668
</pre></div></div>
</div>
<div class="section" id="IV2SLS-as-OLS">
<h3>IV2SLS as OLS<a class="headerlink" href="#IV2SLS-as-OLS" title="Permalink to this headline">¶</a></h3>
<p>As one final check, the “OLS” version of <code class="docutils literal"><span class="pre">IV2SLS</span></code> is compared to
<code class="docutils literal"><span class="pre">statsmodels</span></code> <code class="docutils literal"><span class="pre">OLS</span></code> command. The parameters are identical.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">ivolsmod</span> <span class="o">=</span> <span class="n">IV2SLS</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">ldrugexp</span><span class="p">,</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;hi_empunion&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">controls</span><span class="p">],</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">res_ivols</span> <span class="o">=</span> <span class="n">ivolsmod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">sm_ols</span> <span class="o">=</span> <span class="n">res_ols</span><span class="o">.</span><span class="n">params</span>
<span class="n">sm_ols</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sm&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res_ivols</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">sm_ols</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
             parameter        sm
hi_empunion   0.073879  0.073879
const         5.861131  5.861131
totchr        0.440381  0.440381
female        0.057806  0.057806
age          -0.003529 -0.003529
linc          0.010482  0.010482
blhisp       -0.151307 -0.151307
</pre></div></div>
</div>
</div>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="basic-examples.html" title="previous chapter (use the left arrow)">Basic Examples</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="using-formulas.html" title="next chapter (use the right arrow)">Using formulas to specify models</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="using-formulas.html" title="Using formulas to specify models"
             >next</a> |</li>
        <li class="right" >
          <a href="basic-examples.html" title="Basic Examples"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">linearmodels 3.5+14.gf04346f documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Instrumental Variable Estimation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2017, Kevin Sheppard. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>